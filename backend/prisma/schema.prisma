generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         Int      @id @default(autoincrement())
  username   String   @unique
  password   String
  email      String?
  role       String   @default("user")
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

model Company {
  id              Int         @id @default(autoincrement())
  name            String      @unique
  customer_number String?     @unique
  contact_person  String?
  email           String?
  phone           String?
  address         String?
  city            String?
  postal_code     String?
  country         String?
  federal_state   String?
  notes           String?
  is_active       Boolean     @default(true)
  
  monday_start    String?
  monday_end      String?
  tuesday_start   String?
  tuesday_end     String?
  wednesday_start String?
  wednesday_end   String?
  thursday_start  String?
  thursday_end    String?
  friday_start    String?
  friday_end      String?
  saturday_start  String?
  saturday_end    String?
  sunday_start    String?
  sunday_end      String?
  
  holiday_takeover     Boolean  @default(true)
  holiday_schedule_ref String   @default("sunday")
  
  billing_type    String?
  hourly_rate     Float?
  price_pkw       Float?
  price_lkw       Float?
  price_oilspill  Float?
  service_fee     Float?
  monthly_rate    Float?
  early_takeover_price Float?
  
  created_at      DateTime    @default(now())
  updated_at      DateTime    @updatedAt
  
  takeovers       EarlyTakeover[]
  invoices        Invoice[]
  compensations   HoursCompensation[]
}

model EarlyTakeover {
  id          Int      @id @default(autoincrement())
  company_id  Int
  company     Company  @relation(fields: [company_id], references: [id], onDelete: Cascade)
  
  start_date  DateTime
  end_date    DateTime
  start_time  String
  end_time    String
  notes       String?
  
  created_by  String?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  
  @@index([company_id])
  @@index([start_date, end_date])
}

model Invoice {
  id              Int       @id @default(autoincrement())
  invoice_number  String    @unique
  company_id      Int
  company         Company   @relation(fields: [company_id], references: [id])
  template_id     Int?
  template        InvoiceTemplate? @relation(fields: [template_id], references: [id])
  
  invoice_date    DateTime
  due_date        DateTime
  period_start    DateTime
  period_end      DateTime
  
  billing_type    String
  
  total_hours     Float?
  hourly_rate     Float?
  takeover_hours  Float?
  takeover_rate   Float?
  
  count_pkw       Int?
  count_lkw       Int?
  count_oilspill  Int?
  price_pkw       Float?
  price_lkw       Float?
  price_oilspill  Float?
  service_fee     Float?
  monthly_rate    Float?
  
  subtotal        Float
  tax_rate        Float     @default(19)
  tax_amount      Float
  total_amount    Float
  
  status          String    @default("open")
  paid_date       DateTime?
  dunning_level   Int       @default(0)
  
  notes           String?
  created_by      String?
  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt
  
  payments        Payment[]
  dunnings        Dunning[]
  
  @@index([company_id])
  @@index([invoice_date])
  @@index([status])
}

model Payment {
  id          Int      @id @default(autoincrement())
  invoice_id  Int
  invoice     Invoice  @relation(fields: [invoice_id], references: [id], onDelete: Cascade)
  
  amount      Float
  payment_date DateTime
  payment_method String?
  notes       String?
  
  created_by  String?
  created_at  DateTime @default(now())
  
  @@index([invoice_id])
}

model Dunning {
  id            Int      @id @default(autoincrement())
  invoice_id    Int
  invoice       Invoice  @relation(fields: [invoice_id], references: [id], onDelete: Cascade)
  dunning_level Int
  dunning_date  DateTime
  new_due_date  DateTime
  fee_amount    Float
  created_by    String?
  created_at    DateTime @default(now())
  
  @@index([invoice_id])
}

model SystemSettings {
  id                      Int      @id @default(autoincrement())
  smtp_host               String?
  smtp_port               Int?
  smtp_user               String?
  smtp_password           String?
  smtp_from_address       String?
  
  email_invoice_subject   String?
  email_invoice_body      String?
  email_dunning_subject   String?
  email_dunning_body      String?
  
  created_at              DateTime @default(now())
  updated_at              DateTime @updatedAt
}

model HoursCompensation {
  id          Int      @id @default(autoincrement())
  company_id  Int
  company     Company  @relation(fields: [company_id], references: [id], onDelete: Cascade)
  
  start_date  DateTime
  end_date    DateTime
  total_hours Float
  
  created_by  String?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  
  @@index([company_id])
  @@index([start_date, end_date])
}

model InvoiceTemplate {
  id          Int       @id @default(autoincrement())
  name        String   
  is_default  Boolean   @default(false)
  config      Json
  created_by  String?
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt
  invoices    Invoice[]
}

model Logo {
  id          String   @id @default(uuid())
  name        String
  filename    String   @unique
  url         String
  size        Int
  uploaded_at DateTime @default(now())
}
